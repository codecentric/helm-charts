# Keycloak

[Keycloak](http://www.keycloak.org/) is an open source identity and access management for modern applications and services.

## TL;DR;

```console
$ helm install codecentric/keycloak
```

## Introduction

This chart bootstraps a [Keycloak](http://www.keycloak.org/) StatefulSet on a [Kubernetes](https://kubernetes.io) cluster using the [Helm](https://helm.sh) package manager.
It provisions a fully featured Keycloak installation.
For more information on Keycloak and its capabilities, see its [documentation](http://www.keycloak.org/documentation.html).

## Prerequisites Details

The chart has an optional dependency on the [PostgreSQL](https://github.com/bitnami/charts/tree/master/bitnami/postgresql) chart.
By default, the PostgreSQL chart requires PV support on underlying infrastructure (may be disabled).

## Installing the Chart

To install the chart with the release name `keycloak`:

```console
$ helm install keycloak codecentric/keycloak
```

## Uninstalling the Chart

To uninstall/delete the `keycloak` deployment:

```console
$ helm delete keycloak
```

## Configuration

The following table lists the configurable parameters of the Keycloak chart and their default values.

|                    Parameter                    |                                                                                                                                    Description                                                                                                                                    |                                                Default                                                 |
|-------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
| fullnameOverride                                | Optionally override the fully qualified name                                                                                                                                                                                                                                      | `""`                                                                                                   |
| nameOverride                                    | Optionally override the name                                                                                                                                                                                                                                                      | `""`                                                                                                   |
| replicas                                        | The number of replicas to create                                                                                                                                                                                                                                                  | `1`                                                                                                    |
| image.repository                                | The Keycloak image repository                                                                                                                                                                                                                                                     | `docker.io/jboss/keycloak`                                                                             |
| image.tag                                       | Overrides the Keycloak image tag whose default is the chart version                                                                                                                                                                                                               | `""`                                                                                                   |
| image.pullPolicy                                | The Keycloak image pull policy                                                                                                                                                                                                                                                    | `IfNotPresent`                                                                                         |
| imagePullSecrets                                | Image pull secrets for the Pod                                                                                                                                                                                                                                                    | ``                                                                                                     |
| hostAliases                                     | Mapping between IPs and hostnames that will be injected as entries in the Pod's hosts files                                                                                                                                                                                       | `[]`                                                                                                   |
| enableServiceLinks                              | Indicates whether information about services should be injected into Pod's environment variables, matching the syntax of Docker links                                                                                                                                             | `true`                                                                                                 |
| podManagementPolicy                             | Pod management policy. One of `Parallel` or `OrderedReady`                                                                                                                                                                                                                        | `Parallel`                                                                                             |
| restartPolicy                                   | Pod restart policy. One of `Always`, `OnFailure`, or `Never`                                                                                                                                                                                                                      | `Always`                                                                                               |
| serviceAccount.create                           | Specifies whether a ServiceAccount should be created                                                                                                                                                                                                                              | `true`                                                                                                 |
| serviceAccount.name                             | The name of the service account to use. If not set and create is true, a name is generated using the fullname template                                                                                                                                                            | `""`                                                                                                   |
| serviceAccount.annotations                      | Additional annotations for the ServiceAccount                                                                                                                                                                                                                                     | `{}`                                                                                                   |
| serviceAccount.labels                           | Additional labels for the ServiceAccount                                                                                                                                                                                                                                          | `{}`                                                                                                   |
| serviceAccount.imagePullSecrets                 | Image pull secrets that are attached to the ServiceAccount                                                                                                                                                                                                                        | `[]`                                                                                                   |
| podSecurityContext                              | SecurityContext for the entire Pod. Every container running in the Pod will inherit this SecurityContext. This might be relevant when other components of the environment inject additional containers into running Pods (service meshes are the most prominent example for this) | `{"fsGroup":1000}`                                                                                     |
| securityContext                                 | SecurityContext for the Keycloak container                                                                                                                                                                                                                                        | `{"runAsNonRoot":true,"runAsUser":1000}`                                                               |
| extraInitContainers                             | Additional init containers, e. g. for providing custom themes                                                                                                                                                                                                                     | `[]`                                                                                                   |
| extraContainers                                 | Additional sidecar containers, e. g. for a database proxy, such as Google's cloudsql-proxy                                                                                                                                                                                        | `[]`                                                                                                   |
| lifecycleHooks                                  | Lifecycle hooks for the Keycloak container                                                                                                                                                                                                                                        | `{}`                                                                                                   |
| terminationGracePeriodSeconds                   | Termination grace period in seconds for Keycloak shutdown. Clusters with a large cache might need to extend this to give Infinispan more time to rebalance                                                                                                                        | `60`                                                                                                   |
| clusterDomain                                   | The internal Kubernetes cluster domain                                                                                                                                                                                                                                            | `cluster.local`                                                                                        |
| command                                         | # Overrides the default entrypoint of the Keycloak container                                                                                                                                                                                                                      | `[]`                                                                                                   |
| args                                            | # Overrides the default args for the Keycloak container                                                                                                                                                                                                                           | `[]`                                                                                                   |
| extraEnv                                        | Additional environment variables for Keycloak                                                                                                                                                                                                                                     | `[]`                                                                                                   |
| priorityClassName                               | Pod priority class name                                                                                                                                                                                                                                                           | `""`                                                                                                   |
| affinity                                        | Pod affinity                                                                                                                                                                                                                                                                      | `{}`                                                                                                   |
| nodeSelector                                    | Node labels for Pod assignment                                                                                                                                                                                                                                                    | `{}`                                                                                                   |
| tolerations                                     | Node taints to tolerate                                                                                                                                                                                                                                                           | `[]`                                                                                                   |
| podLabels                                       | Additional Pod labels                                                                                                                                                                                                                                                             | `{}`                                                                                                   |
| podAnnotations                                  | Additional Pod annotations                                                                                                                                                                                                                                                        | `{}`                                                                                                   |
| livenessProbe                                   | Liveness probe configuration                                                                                                                                                                                                                                                      | `{"httpGet":{"path":"/auth","port":"http"},"initialDelaySeconds":300,"timeoutSeconds":5}`              |
| readinessProbe                                  | Readiness probe configuration                                                                                                                                                                                                                                                     | `{"httpGet":{"path":"/auth/realms/master","port":"http"},"initialDelaySeconds":30,"timeoutSeconds":1}` |
| resources                                       | Pod resource requests and limits                                                                                                                                                                                                                                                  | `{}`                                                                                                   |
| startupScripts                                  | Startup scripts to run before Keycloak starts up                                                                                                                                                                                                                                  | `{"keycloak.cli":"{{- .Files.Get \"scripts/keycloak.cli\" | nindent 2 }}\n"}`                          |
| extraVolumes                                    | Add additional volumes, e. g. for custom themes                                                                                                                                                                                                                                   | `[]`                                                                                                   |
| extraVolumeMounts                               | Add additional volumes mounts, e. g. for custom themes                                                                                                                                                                                                                            | `[]`                                                                                                   |
| extraPorts                                      | Add additional ports, e. g. for admin console or exposing JGroups ports                                                                                                                                                                                                           | `[]`                                                                                                   |
| podDisruptionBudget                             | Pod disruption budget                                                                                                                                                                                                                                                             | `{}`                                                                                                   |
| statefulsetAnnotations                          | Annotations for the StatefulSet                                                                                                                                                                                                                                                   | `{}`                                                                                                   |
| statefulsetLabels                               | Additional labels for the StatefulSet                                                                                                                                                                                                                                             | `{}`                                                                                                   |
| secrets                                         | Configuration for secrets that should be created                                                                                                                                                                                                                                  | `[]`                                                                                                   |
| service.annotations                             | Annotations for headless and HTTP Services                                                                                                                                                                                                                                        | `{}`                                                                                                   |
| service.labels                                  | Additional labels for headless and HTTP Services                                                                                                                                                                                                                                  | `{}`                                                                                                   |
| service.type                                    | key: value The Service type                                                                                                                                                                                                                                                       | `ClusterIP`                                                                                            |
| service.nodePort                                | Optional static port assignment for Service type NodePort.                                                                                                                                                                                                                        | `""`                                                                                                   |
| service.httpPort                                | The http Service port                                                                                                                                                                                                                                                             | `80`                                                                                                   |
| service.httpNodePort                            | The HTTP Service node port if type is NodePort                                                                                                                                                                                                                                    | `""`                                                                                                   |
| service.httpsPort                               | The HTTPS Service port                                                                                                                                                                                                                                                            | `8443`                                                                                                 |
| service.httpsNodePort                           | The HTTPS Service node port if type is NodePort                                                                                                                                                                                                                                   | `""`                                                                                                   |
| service.extraPorts                              | Additional Service ports, e. g. for custom admin console                                                                                                                                                                                                                          | `[]`                                                                                                   |
| ingress.enabled                                 | If `true`, an Ingress is created                                                                                                                                                                                                                                                  | `false`                                                                                                |
| ingress.path                                    | Path for the Ingress                                                                                                                                                                                                                                                              | `/`                                                                                                    |
| ingress.servicePort                             | The Service port targeted by the Ingress                                                                                                                                                                                                                                          | `http`                                                                                                 |
| ingress.annotations                             | Ingress annotations                                                                                                                                                                                                                                                               | `{}`                                                                                                   |
| ingress.labels                                  | Additional Ingress labels                                                                                                                                                                                                                                                         | `{}`                                                                                                   |
| ingress.tls                                     | TLS configuration                                                                                                                                                                                                                                                                 | `[]`                                                                                                   |
| route.enabled                                   | If `true`, an OpenShift Route is created                                                                                                                                                                                                                                          | `false`                                                                                                |
| route.path                                      | Path for the Route                                                                                                                                                                                                                                                                | `/`                                                                                                    |
| route.annotations                               | Route annotations                                                                                                                                                                                                                                                                 | `{}`                                                                                                   |
| route.labels                                    | Additional Route labels                                                                                                                                                                                                                                                           | `{}`                                                                                                   |
| route.host                                      | Host name for the Route                                                                                                                                                                                                                                                           | `""`                                                                                                   |
| route.tls.enabled                               | If `true`, TLS is enabled for the Route                                                                                                                                                                                                                                           | `true`                                                                                                 |
| route.tls.insecureEdgeTerminationPolicy         | Insecure edge termination policy of the Route. Can be `None`, `Redirect`, or `Allow`                                                                                                                                                                                              | `Redirect`                                                                                             |
| route.tls.termination                           | TLS termination of the route. Can be `edge`, `passthrough`, or `reencrypt`                                                                                                                                                                                                        | `edge`                                                                                                 |
| pgchecker.image.repository                      | Docker image used to check Postgresql readiness at startup                                                                                                                                                                                                                        | `docker.io/busybox`                                                                                    |
| pgchecker.image.tag                             | Image tag for the pgchecker image                                                                                                                                                                                                                                                 | `1.32`                                                                                                 |
| pgchecker.image.pullPolicy                      | Image pull policy for the pgchecker image                                                                                                                                                                                                                                         | `IfNotPresent`                                                                                         |
| pgchecker.securityContext                       | SecurityContext for the pgchecker container                                                                                                                                                                                                                                       | `{"allowPrivilegeEscalation":false,"runAsGroup":1000,"runAsNonRoot":true,"runAsUser":1000}`            |
| pgchecker.resources                             | Resource requests and limits for the pgchecker container                                                                                                                                                                                                                          | `{"limits":{"cpu":"10m","memory":"16Mi"},"requests":{"cpu":"10m","memory":"16Mi"}}`                    |
| postgresql.enabled                              | If `true`, the Postgresql dependency is enabled                                                                                                                                                                                                                                   | `true`                                                                                                 |
| postgresql.postgresqlUsername                   | PostgreSQL User to create                                                                                                                                                                                                                                                         | `keycloak`                                                                                             |
| postgresql.postgresqlPassword                   | PostgreSQL Password for the new user                                                                                                                                                                                                                                              | `keycloak`                                                                                             |
| postgresql.postgresqlDatabase                   | PostgreSQL Database to create                                                                                                                                                                                                                                                     | `keycloak`                                                                                             |
| prometheusOperator.enabled                      | If `true`, a ServiceMonitor resource for the prometheus-operator is created                                                                                                                                                                                                       | `false`                                                                                                |
| prometheusOperator.serviceMonitor.namespace     | Optionally sets a target namespace in which to deploy the ServiceMonitor resource                                                                                                                                                                                                 | `""`                                                                                                   |
| prometheusOperator.serviceMonitor.annotations   | Annotations for the ServiceMonitor                                                                                                                                                                                                                                                | `{}`                                                                                                   |
| prometheusOperator.serviceMonitor.labels        | Additional labels for the ServiceMonitor                                                                                                                                                                                                                                          | `{}`                                                                                                   |
| prometheusOperator.serviceMonitor.interval      | Interval at which Prometheus scrapes metrics                                                                                                                                                                                                                                      | `10s`                                                                                                  |
| prometheusOperator.serviceMonitor.scrapeTimeout | Timeout for scraping                                                                                                                                                                                                                                                              | `10s`                                                                                                  |
| prometheusOperator.serviceMonitor.path          | The path at which metrics are served                                                                                                                                                                                                                                              | `/auth/realms/master/metrics`                                                                          |
| prometheusOperator.serviceMonitor.port          | The Service port at which metrics are served                                                                                                                                                                                                                                      | `http`                                                                                                 |
| prometheusOperator.prometheusRule.enabled       | If `true`, a PrometheusRule resource for the prometheus-operator is created                                                                                                                                                                                                       | `false`                                                                                                |
| prometheusOperator.prometheusRule.annotations   | Annotations for the PrometheusRule                                                                                                                                                                                                                                                | `{}`                                                                                                   |
| prometheusOperator.prometheusRule.labels        | Additional labels for the PrometheusRule                                                                                                                                                                                                                                          | `{}`                                                                                                   |
| prometheusOperator.prometheusRule.rules         | List of rules for Prometheus                                                                                                                                                                                                                                                      | ``                                                                                                     |
| test.enabled                                    | If `true`, test resources are created                                                                                                                                                                                                                                             | `false`                                                                                                |
| test.image.repository                           | The image for the test Pod                                                                                                                                                                                                                                                        | `docker.io/unguiculus/docker-python3-phantomjs-selenium`                                               |
| test.image.tag                                  | The tag for the test Pod image                                                                                                                                                                                                                                                    | `v1`                                                                                                   |
| test.image.pullPolicy                           | The image pull policy for the test Pod image                                                                                                                                                                                                                                      | `IfNotPresent`                                                                                         |
| test.podSecurityContext                         | SecurityContext for the entire test Pod                                                                                                                                                                                                                                           | `{"fsGroup":1000}`                                                                                     |
| test.securityContext                            | SecurityContext for the test container                                                                                                                                                                                                                                            | `{"runAsNonRoot":true,"runAsUser":1000}`                                                               |


Specify each parameter using the `--set key=value[,key=value]` argument to `helm install`. For example:

```console
$ helm install keycloak codecentric/keycloak -n keycloak --version=9.0.0 --set replicas=1
```

Alternatively, a YAML file that specifies the values for the parameters can be provided while
installing the chart. For example:

```console
$ helm install keycloak codecentric/keycloak -n keycloak --version=9.0.0 --values values.yaml
```
